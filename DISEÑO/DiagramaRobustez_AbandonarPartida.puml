@startuml DiagramaRobustez_AbandonarPartida

title Diagrama de Robustez - CU06: Abandonar Partida

skinparam backgroundColor White

' ==================== ACTORES ====================
actor "Jugador que Abandona" as jugadorAbandona
actor "Jugador Oponente" as jugadorOponente

' ==================== BOUNDARY (Azul) ====================
rectangle "FrmPartidaEnCurso" as frmPartida #LightBlue
rectangle "DialogoConfirmacion" as dialogo #LightBlue
rectangle "FrmFinPartida" as frmFin #LightBlue
rectangle "FrmMenuPrincipal" as frmMenu #LightBlue

' ==================== CONTROL (Amarillo) ====================
rectangle "ControlVista" as cv #LightYellow
rectangle "Controlador" as ctrl #LightYellow
rectangle "ControlModelo" as modelo #LightYellow
rectangle "BusEventos" as bus #LightYellow
rectangle "GestorPartida" as gestor #LightYellow

' ==================== ENTITY (Verde) ====================
rectangle "JugadorDTO" as jdto #LightGreen
rectangle "Partida" as partida #LightGreen

' ==================== FLUJO ABANDONAR ====================
jugadorAbandona --> frmPartida : 1. Click Abandonar
frmPartida --> dialogo : 2. Mostrar confirmacion
jugadorAbandona --> dialogo : 3. Click Si
dialogo --> cv : 4. abandonarPartida()
cv --> ctrl : 5. abandonarPartida(jugador)
ctrl --> modelo : 6. abandonarPartida()
modelo --> jdto : 7. estado = ABANDONO
ctrl --> bus : 8. ABANDONAR_PARTIDA
bus --> gestor : 9. procesarAbandono()
gestor --> partida : 10. Remover jugador
gestor --> gestor : 11. Oponente gana
bus --> bus : 12. publicar JUGADOR_ABANDONO
bus --> bus : 13. publicar FIN_PARTIDA

' ==================== FLUJO JUGADOR QUE ABANDONA ====================
cv --> modelo : 14a. reiniciar()
cv --> frmMenu : 15a. Volver al menu
frmMenu --> jugadorAbandona : 16a. Mostrar menu

' ==================== FLUJO OPONENTE ====================
bus --> ctrl : 14b. FIN_PARTIDA
ctrl --> cv : 15b. manejarFinPartida()
cv --> frmFin : 16b. Mostrar victoria
frmFin --> jugadorOponente : 17b. Ganaste por abandono

' ==================== NOTAS ====================
note right of gestor
  **Acciones segun contexto:**

  Host abandona lobby:
  - Limpiar TODA partida

  Invitado abandona lobby:
  - Solo remover invitado

  Durante partida:
  - El otro gana
end note

note bottom of frmFin
  **Mensajes:**
  - Ganaste! Oponente abandono
  - Abandonaste la partida
end note

legend right
  |= Color |= Tipo |
  |<#LightBlue> Azul </color>| Boundary |
  |<#LightYellow> Amarillo </color>| Control |
  |<#LightGreen> Verde </color>| Entity |
endlegend

@enduml
